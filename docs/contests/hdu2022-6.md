!!!note "[1001.Multiply 2 Divide 2](http://acm.hdu.edu.cn/contest/problem?cid=1049&pid=1001)"

    每次把一个数乘二或除以二，让序列单调不减的最小操作次数。

    $n,a_i\leq 10^5$

首先一个数一定是先除以再乘，那么一个很暴力的DP是$f_{i,j,k}$表示考虑到$i$个数，它除以了$j$次，乘了$k$次的最小操作次数。但是第三维其实是可以到200左右的，所以直接DP不行。

设$m=10^5$为值域上界，一个性质是，如果一个数最终超过了$m$，那么它后面的数也会超过$m$，且如果最优方案下它超过以后又乘了$k$次，后面的数也要跟着乘$k$次。那么考虑把$f$的第三维开到$\log m$级别，现在就要考虑当一个数恰好超过$m$时后面的最优方式。于是设$g_{i,j}$表示第$i$个数除以了$j$次并恰好超过$m$时，后面的数最少要操作多少次。这个东西可以倒着转移。转移的时候要么后面整体乘2，要么不改变，转移一个状态是$O(\log m)$的，计算$g$的复杂度就是$O(n\log ^2m)$。

现在瓶颈在转移$f$，我们需要做到均摊$O(1)$的转移，观察到这个转移是单调的，可以用双指针优化。

最后复杂度$O(n\log ^2m)$
